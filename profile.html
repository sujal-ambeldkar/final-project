<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Music Player - Profile</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
      transition: background 0.3s, color 0.3s;
      min-height: 100vh;
      padding-bottom: 100px;
    }

    body.dark {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: #fff;
    }

    /* Header */
    .header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 20px 40px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
      position: sticky;
      top: 0;
      z-index: 50;
    }

    body.dark .header {
      background: #101010;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .user-avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea, #764ba2);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
      font-weight: bold;
    }

    .user-info h2 {
      font-size: 20px;
      margin-bottom: 3px;
    }

    .user-info p {
      font-size: 12px;
      color: #666;
    }

    body.dark .user-info p {
      color: #aaa;
    }

    .header-right {
      display: flex;
      gap: 15px;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 25px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s;
      font-weight: 600;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
      background: #f0f0f0;
      color: #333;
    }

    body.dark .btn-secondary {
      background: #2a2a3e;
      color: #fff;
    }

    .btn-secondary:hover {
      background: #e0e0e0;
    }

    body.dark .btn-secondary:hover {
      background: #3a3a4e;
    }

    /* Container */
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 30px 40px;
    }

    /* Section Title */
    .section-title {
      font-size: 28px;
      margin-bottom: 20px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 10px;
      color:black;
    }

    body.dark .section-title {
      color: white;
    }

    /* Upload Section */
    .upload-section {
      background: white;
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
    }

    body.dark .upload-section {
      background: #101010;
    }

    .upload-form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    .form-group label {
      margin-bottom: 8px;
      font-weight: 600;
      font-size: 14px;
      color: #555;
    }

    body.dark .form-group label {
      color: #ccc;
    }

    .form-group input[type="text"] {
      padding: 12px 15px;
      border: 2px solid #e0e0e0;
      border-radius: 10px;
      font-size: 14px;
      transition: border-color 0.3s;
    }

    body.dark .form-group input[type="text"] {
      background: #2a2a3e;
      border-color: #3a3a4e;
      color: white;
    }

    .form-group input[type="text"]:focus {
      outline: none;
      border-color: #667eea;
    }

    .file-input-wrapper {
      position: relative;
      overflow: hidden;
      display: inline-block;
      width: 100%;
    }

    .file-input-wrapper input[type=file] {
      position: absolute;
      left: -9999px;
    }

    .file-input-label {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 15px;
      border: 2px dashed #d0d0d0;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      background: #f9f9f9;
    }

    body.dark .file-input-label {
      background: #2a2a3e;
      border-color: #3a3a4e;
    }

    .file-input-label:hover {
      border-color: #667eea;
      background: #f0f0ff;
    }

    body.dark .file-input-label:hover {
      background: #3a3a4e;
    }

    .file-input-label.has-file {
      border-color: #4caf50;
      background: #e8f5e9;
    }

    body.dark .file-input-label.has-file {
      background: #1e3a1e;
      border-color: #4caf50;
    }

    .upload-btn-full {
      grid-column: 1 / -1;
      padding: 15px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .upload-btn-full:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
    }

    .upload-msg {
      grid-column: 1 / -1;
      text-align: center;
      padding: 10px;
      border-radius: 10px;
      display: none;
    }

    .upload-msg.success {
      background: #e8f5e9;
      color: #2e7d32;
      display: block;
    }

    .upload-msg.error {
      background: #ffebee;
      color: #c62828;
      display: block;
    }

    /* Cards Grid */
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .card {
      background: white;
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
      transition: all 0.3s;
    }

    body.dark .card {
      background: #1e1e2e;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
    }

    .card h3 {
      margin-bottom: 20px;
      font-size: 20px;
      color: #333;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    body.dark .card h3 {
      color: #fff;
    }

    /* Song Cards */
    .song-card {
      display: flex;
      align-items: center;
      padding: 12px;
      margin-bottom: 10px;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
      background: #f9f9f9;
    }

    body.dark .song-card {
      background: #2a2a3e;
    }

    .song-card:hover {
      background: #f0f0ff;
      transform: translateX(5px);
    }

    body.dark .song-card:hover {
      background: #3a3a4e;
    }

    .song-card img {
      width: 50px;
      height: 50px;
      object-fit: cover;
      margin-right: 15px;
      border-radius: 8px;
    }

    .song-info {
      flex: 1;
    }

    .song-info .title {
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 3px;
    }

    .song-info .artist {
      font-size: 12px;
      color: #666;
    }

    body.dark .song-info .artist {
      color: #aaa;
    }

    .delete-btn {
      background: #ff4d4d;
      border: none;
      color: white;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.3s;
    }

    .delete-btn:hover {
      background: #ff3333;
      transform: scale(1.1);
    }

    /* Community Uploads Section */
    .community-section {
      background: white;
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 30px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
    }

    body.dark .community-section {
      background: #101010;
    }

    .community-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .community-song-card {
      display: flex;
      align-items: center;
      background: #f9f9f9;
      padding: 15px;
      border-radius: 15px;
      transition: all 0.3s;
    }

    body.dark .community-song-card {
      background: #2a2a3e;
    }

    .community-song-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
    }

    .song-cover {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 10px;
      margin-right: 15px;
    }

    .community-song-info {
      flex: 1;
    }

    .community-song-info h4 {
      margin: 0 0 5px 0;
      font-size: 16px;
    }

    .community-song-info .artist {
      margin: 0 0 5px 0;
      color: #666;
      font-size: 13px;
    }

    body.dark .community-song-info .artist {
      color: #aaa;
    }

    .community-song-info .uploader {
      margin: 0 0 3px 0;
      color: #888;
      font-size: 11px;
      font-style: italic;
    }

    body.dark .community-song-info .uploader {
      color: #999;
    }

    .community-song-info .date {
      margin: 0;
      color: #999;
      font-size: 10px;
    }

    .action-buttons {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .play-btn, .save-btn {
      padding: 8px 15px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      transition: all 0.3s;
    }

    .play-btn {
      background: #667eea;
      color: white;
    }

    .play-btn:hover {
      background: #5568d3;
      transform: scale(1.05);
    }

    .save-btn {
      background: #4caf50;
      color: white;
    }

    .save-btn:hover {
      background: #45a049;
      transform: scale(1.05);
    }

    /* Professional Music Player Bar */
    #player-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: rgba(255, 255, 255, 0.98);
      backdrop-filter: blur(30px);
      border-top: 1px solid rgba(0, 0, 0, 0.1);
      padding: 12px 20px;
      box-shadow: 0 -5px 30px rgba(0, 0, 0, 0.1);
      display: none;
      z-index: 100;
      transition: all 0.3s;
    }

    body.dark #player-bar {
      background: rgba(30, 30, 46, 0.98);
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .player-content {
      display: grid;
      grid-template-columns: 1fr 2fr 1fr;
      align-items: center;
      gap: 20px;
      max-width: 1800px;
      margin: 0 auto;
    }

    /* Left Section */
    .player-left {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    #player-img {
      width: 56px;
      height: 56px;
      object-fit: cover;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .player-song-info {
      flex: 1;
      min-width: 0;
    }

    #player-title {
      font-size: 14px;
      font-weight: 600;
      color: #333;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      margin-bottom: 3px;
    }

    body.dark #player-title {
      color: #fff;
    }

    #player-artist {
      font-size: 12px;
      color: #666;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    body.dark #player-artist {
      color: #aaa;
    }

    /* Center Section */
    .player-center {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .player-controls {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 16px;
    }

    .player-control-btn {
      background: none;
      border: none;
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
      color: #666;
    }

    body.dark .player-control-btn {
      color: #aaa;
    }

    .player-control-btn:hover {
      color: #333;
      background: rgba(0, 0, 0, 0.05);
      transform: scale(1.1);
    }

    body.dark .player-control-btn:hover {
      color: #fff;
      background: rgba(255, 255, 255, 0.1);
    }

    .player-control-btn svg {
      width: 20px;
      height: 20px;
    }

    .play-pause-btn {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white !important;
      width: 40px;
      height: 40px;
      padding: 0;
    }

    .play-pause-btn:hover {
      background: linear-gradient(135deg, #5568d3, #6a3d8f);
      transform: scale(1.1);
    }

    .play-pause-btn svg {
      width: 24px;
      height: 24px;
    }

    /* Progress Bar */
    .player-progress-container {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .time-current,
    .time-total {
      font-size: 11px;
      color: #666;
      min-width: 40px;
      text-align: center;
    }

    body.dark .time-current,
    body.dark .time-total {
      color: #aaa;
    }

    .progress-bar {
      flex: 1;
      height: 4px;
      background: #e0e0e0;
      border-radius: 2px;
      position: relative;
      cursor: pointer;
      overflow: visible;
    }

    body.dark .progress-bar {
      background: #3a3a4e;
    }

    .progress-bar:hover .progress-bar-handle {
      opacity: 1;
    }

    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea, #764ba2);
      border-radius: 2px;
      width: 0%;
      transition: width 0.1s linear;
    }

    .progress-bar-handle {
      position: absolute;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 12px;
      height: 12px;
      background: white;
      border-radius: 50%;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
      opacity: 0;
      transition: opacity 0.2s;
      left: 0%;
      cursor: grab;
    }

    .progress-bar-handle:active {
      cursor: grabbing;
    }

    /* Right Section */
    .player-right {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      gap: 8px;
    }

    .player-icon-btn {
      background: none;
      border: none;
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
      color: #666;
    }

    body.dark .player-icon-btn {
      color: #aaa;
    }

    .player-icon-btn:hover {
      color: #333;
      background: rgba(0, 0, 0, 0.05);
    }

    body.dark .player-icon-btn:hover {
      color: #fff;
      background: rgba(255, 255, 255, 0.1);
    }

    .player-icon-btn svg {
      width: 20px;
      height: 20px;
    }

    .player-icon-btn.active {
      color: #667eea;
    }

    body.dark .player-icon-btn.active {
      color: #8b9bff;
    }

    /* Volume Slider */
    .volume-slider {
      width: 100px;
      opacity: 0;
      transition: opacity 0.3s;
      pointer-events: none;
    }

    .player-right:hover .volume-slider {
      opacity: 1;
      pointer-events: all;
    }

    #volume-control {
      width: 100%;
      height: 4px;
      border-radius: 2px;
      background: #e0e0e0;
      outline: none;
      -webkit-appearance: none;
      cursor: pointer;
    }

    body.dark #volume-control {
      background: #3a3a4e;
    }

    #volume-control::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea, #764ba2);
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    #volume-control::-moz-range-thumb {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea, #764ba2);
      cursor: pointer;
      border: none;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    /* Hide default audio element */
    #player-audio {
      display: none;
    }

    /* Toast */
    #toast {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #4caf50;
      color: white;
      padding: 15px 25px;
      border-radius: 10px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
      opacity: 0;
      transition: opacity 0.5s;
      z-index: 1000;
    }

    #toast.show {
      opacity: 1;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 40px;
      color: #999;
    }

    .empty-state-icon {
      font-size: 48px;
      margin-bottom: 15px;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .player-content {
        grid-template-columns: 1fr 1.5fr 0.5fr;
      }
      
      .volume-slider {
        display: none;
      }
    }

    @media (max-width: 768px) {
      .header {
        padding: 15px 20px;
      }

      .container {
        padding: 20px;
      }

      .upload-form {
        grid-template-columns: 1fr;
      }

      .cards-grid {
        grid-template-columns: 1fr;
      }

      .community-grid {
        grid-template-columns: 1fr;
      }

      .player-content {
        grid-template-columns: 1fr;
        gap: 10px;
      }

      .player-left {
        justify-content: space-between;
      }

      #like-btn {
        order: 3;
      }

      .player-right {
        display: none;
      }

      .player-progress-container {
        margin-top: 5px;
      }
    }
    body.light .section-title {

    }
  </style>
</head>

<body>
  <!-- Header -->
  <div class="header">
    <div class="header-left">
      <div class="user-avatar" id="user-avatar">U</div>
      <div class="user-info">
        <h2 id="username">Username</h2>
        <p>Music Enthusiast</p>
      </div>
    </div>
    <div class="header-right">
      <button class="btn btn-primary" onclick="window.location.href='index.html'">üè† Home</button>
      <button class="btn btn-secondary" id="toggle-btn">üåô Dark Mode</button>
    </div>
  </div>

  <!-- Main Container -->
  <div class="container">
    <!-- Upload Section -->
    <div class="upload-section">
      <h3 class="section-title">üéµ Upload Your Song</h3>
      <p style="color: #666; margin-bottom: 20px;">Share your music with the community</p>
      <form id="uploadForm" class="upload-form" enctype="multipart/form-data">
        <div class="form-group">
          <label for="title">Song Title *</label>
          <input type="text" id="title" placeholder="Enter song title" required>
        </div>
        <div class="form-group">
          <label for="artist">Artist Name</label>
          <input type="text" id="artist" placeholder="Enter artist name">
        </div>
        <div class="form-group">
          <label>Audio File (MP3/WAV, max 10MB) *</label>
          <div class="file-input-wrapper">
            <input type="file" id="songFile" name="songFile" accept=".mp3,.wav,audio/mpeg,audio/wav" required>
            <label for="songFile" class="file-input-label" id="songFileLabel">
              <span>üéµ Choose audio file</span>
            </label>
          </div>
        </div>
        <div class="form-group">
          <label>Album Cover (JPEG/PNG, max 10MB) *</label>
          <div class="file-input-wrapper">
            <input type="file" id="albumImage" name="albumImage" accept=".jpg,.jpeg,.png,image/jpeg,image/png" required>
            <label for="albumImage" class="file-input-label" id="albumImageLabel">
              <span>üñºÔ∏è Choose image file</span>
            </label>
          </div>
        </div>
        <button type="submit" class="upload-btn-full">Upload Song</button>
        <div id="uploadMsg" class="upload-msg"></div>
      </form>
    </div>

    <!-- Cards Grid -->
    <div class="cards-grid">
      <!-- Saved Songs -->
      <div class="card">
        <h3>üíæ My Saved Songs</h3>
        <div id="savedSongsList">
          <div class="empty-state">
            <div class="empty-state-icon">üéµ</div>
            <p>Loading...</p>
          </div>
        </div>
      </div>

      <!-- Trending Songs -->
      <div class="card">
        <h3>üî• Trending Now</h3>
        <div id="trending">
          <div class="empty-state">
            <div class="empty-state-icon">‚è≥</div>
            <p>Loading trending songs...</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Community Uploads -->
    <div class="community-section">
      <h3 class="section-title" >üåç Community Uploads</h3>
      <p style="color: #666; margin-bottom: 20px;">Discover music from other users</p>
      <div id="community-uploads" class="community-grid">
        <div class="empty-state">
          <div class="empty-state-icon">üé∂</div>
          <p>Loading community uploads...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast"></div>

  <!-- Professional Music Player Bar -->
  <div id="player-bar">
    <div class="player-content">
      <!-- Left: Song Info -->
      <div class="player-left">
        <img id="player-img" src="" alt="song">
        <div class="player-song-info">
          <div id="player-title">No song playing</div>
          <div id="player-artist">Select a song to play</div>
        </div>
        <button class="player-icon-btn" id="like-btn" title="Like">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>
          </svg>
        </button>
      </div>

      <!-- Center: Player Controls -->
      <div class="player-center">
        <div class="player-controls">
          <button class="player-control-btn" id="shuffle-btn" title="Shuffle">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M10.59 9.17L5.41 4 4 5.41l5.17 5.17 1.42-1.41zM14.5 4l2.04 2.04L4 18.59 5.41 20 17.96 7.46 20 9.5V4h-5.5zm.33 9.41l-1.41 1.41 3.13 3.13L14.5 20H20v-5.5l-2.04 2.04-3.13-3.13z"/>
            </svg>
          </button>
          <button class="player-control-btn" id="prev-btn" title="Previous">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M6 6h2v12H6zm3.5 6l8.5 6V6z"/>
            </svg>
          </button>
          <button class="player-control-btn play-pause-btn" id="play-pause-btn" title="Play">
            <svg id="play-icon" viewBox="0 0 24 24" fill="currentColor">
              <path d="M8 5v14l11-7z"/>
            </svg>
            <svg id="pause-icon" viewBox="0 0 24 24" fill="currentColor" style="display: none;">
              <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z"/>
            </svg>
          </button>
          <button class="player-control-btn" id="next-btn" title="Next">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M6 18l8.5-6L6 6v12zM16 6v12h2V6h-2z"/>
            </svg>
          </button>
          <button class="player-control-btn" id="repeat-btn" title="Repeat">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M7 7h10v3l4-4-4-4v3H5v6h2V7zm10 10H7v-3l-4 4 4 4v-3h12v-6h-2v4z"/>
            </svg>
          </button>
        </div>
        <div class="player-progress-container">
          <span class="time-current" id="time-current">0:00</span>
          <div class="progress-bar" id="progress-bar">
            <div class="progress-bar-fill" id="progress-bar-fill"></div>
            <div class="progress-bar-handle" id="progress-bar-handle"></div>
          </div>
          <span class="time-total" id="time-total">0:00</span>
        </div>
      </div>

      <!-- Right: Volume & Additional Controls -->
      <div class="player-right">
        <button class="player-icon-btn" id="queue-btn" title="Queue">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M15 6H3v2h12V6zm0 4H3v2h12v-2zM3 16h8v-2H3v2zM17 6v8.18c-.31-.11-.65-.18-1-.18-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3V8h3V6h-5z"/>
          </svg>
        </button>
        <button class="player-icon-btn" id="volume-btn" title="Volume">
          <svg id="volume-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
          </svg>
        </button>
        <div class="volume-slider" id="volume-slider">
          <input type="range" id="volume-control" min="0" max="100" value="80">
        </div>
      </div>
    </div>
    <audio id="player-audio" preload="metadata"></audio>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const currentUser = JSON.parse(localStorage.getItem("user"));
      if (!currentUser) {
        alert("Please login first!");
        window.location.href = "login.html";
        return;
      }

      const username = currentUser.username;
      document.getElementById("username").textContent = username;
      document.getElementById("user-avatar").textContent = username.charAt(0).toUpperCase();

      // Theme Toggle
      const toggleBtn = document.getElementById("toggle-btn");
      const body = document.body;
      const savedTheme = localStorage.getItem("theme");
      if (savedTheme === "dark") {
        body.classList.add("dark");
        toggleBtn.textContent = "‚òÄÔ∏è Light Mode";
      }
      toggleBtn.addEventListener("click", () => {
        body.classList.toggle("dark");
        if (body.classList.contains("dark")) {
          toggleBtn.textContent = "‚òÄÔ∏è Light Mode";
          localStorage.setItem("theme", "dark");
        } else {
          toggleBtn.textContent = "üåô Dark Mode";
          localStorage.setItem("theme", "light");
        }
      });

      // File Input Handlers
      const songFileInput = document.getElementById("songFile");
      const albumImageInput = document.getElementById("albumImage");
      const songFileLabel = document.getElementById("songFileLabel");
      const albumImageLabel = document.getElementById("albumImageLabel");

      songFileInput.addEventListener("change", (e) => {
        if (e.target.files.length > 0) {
          const fileName = e.target.files[0].name;
          songFileLabel.classList.add("has-file");
          songFileLabel.querySelector("span").textContent = `üéµ ${fileName}`;
        }
      });

      albumImageInput.addEventListener("change", (e) => {
        if (e.target.files.length > 0) {
          const fileName = e.target.files[0].name;
          albumImageLabel.classList.add("has-file");
          albumImageLabel.querySelector("span").textContent = `üñºÔ∏è ${fileName}`;
        }
      });

      // Upload Form
      document.getElementById("uploadForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const formData = new FormData();
        formData.append("title", document.getElementById("title").value);
        formData.append("artist", document.getElementById("artist").value);
        formData.append("songFile", songFileInput.files[0]);
        formData.append("albumImage", albumImageInput.files[0]);
        formData.append("username", username);

        const uploadMsg = document.getElementById("uploadMsg");
        uploadMsg.textContent = "Uploading...";
        uploadMsg.className = "upload-msg";
        uploadMsg.style.display = "block";

        try {
          const res = await fetch("https://final-project-backend-2-b3de.onrender.com/upload-song", ... {
            method: "POST",
            body: formData,
          });
          const data = await res.json();
          
          if (data.success) {
            uploadMsg.textContent = data.message;
            uploadMsg.className = "upload-msg success";
            document.getElementById("uploadForm").reset();
            songFileLabel.classList.remove("has-file");
            albumImageLabel.classList.remove("has-file");
            songFileLabel.querySelector("span").textContent = "üéµ Choose audio file";
            albumImageLabel.querySelector("span").textContent = "üñºÔ∏è Choose image file";
            showToast("Upload successful! üéâ");
            setTimeout(() => {
              loadCommunityUploads();
              loadSavedSongs();
            }, 1000);
          } else {
            uploadMsg.textContent = data.message;
            uploadMsg.className = "upload-msg error";
          }
        } catch (err) {
          console.error("Upload error:", err);
          uploadMsg.textContent = "Upload failed. Please try again.";
          uploadMsg.className = "upload-msg error";
        }
      });

      // Enhanced Player Controls
      const playerAudio = document.getElementById("player-audio");
      const playPauseBtn = document.getElementById("play-pause-btn");
      const playIcon = document.getElementById("play-icon");
      const pauseIcon = document.getElementById("pause-icon");
      const prevBtn = document.getElementById("prev-btn");
      const nextBtn = document.getElementById("next-btn");
      const shuffleBtn = document.getElementById("shuffle-btn");
      const repeatBtn = document.getElementById("repeat-btn");
      const likeBtn = document.getElementById("like-btn");
      const volumeBtn = document.getElementById("volume-btn");
      const volumeControl = document.getElementById("volume-control");
      const progressBar = document.getElementById("progress-bar");
      const progressBarFill = document.getElementById("progress-bar-fill");
      const progressBarHandle = document.getElementById("progress-bar-handle");
      const timeCurrent = document.getElementById("time-current");
      const timeTotal = document.getElementById("time-total");
      const playerImg = document.getElementById("player-img");

      let isPlaying = false;
      let isShuffle = false;
      let repeatMode = 0;

      // Play/Pause
      playPauseBtn.addEventListener("click", () => {
        if (isPlaying) {
          playerAudio.pause();
        } else {
          playerAudio.play();
        }
      });

      playerAudio.addEventListener("play", () => {
        isPlaying = true;
        playIcon.style.display = "none";
        pauseIcon.style.display = "block";
      });

      playerAudio.addEventListener("pause", () => {
        isPlaying = false;
        playIcon.style.display = "block";
        pauseIcon.style.display = "none";
      });

      // Time formatting
      function formatTime(seconds) {
        if (isNaN(seconds)) return "0:00";
        const mins = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${mins}:${secs < 10 ? "0" : ""}${secs}`;
      }

      // Update progress
      playerAudio.addEventListener("timeupdate", () => {
        const current = playerAudio.currentTime;
        const duration = playerAudio.duration;
        
        if (duration) {
          const percent = (current / duration) * 100;
          progressBarFill.style.width = `${percent}%`;
          progressBarHandle.style.left = `${percent}%`;
          timeCurrent.textContent = formatTime(current);
        }
      });

      playerAudio.addEventListener("loadedmetadata", () => {
        timeTotal.textContent = formatTime(playerAudio.duration);
      });

      // Progress bar click
      progressBar.addEventListener("click", (e) => {
        const rect = progressBar.getBoundingClientRect();
        const percent = (e.clientX - rect.left) / rect.width;
        playerAudio.currentTime = percent * playerAudio.duration;
      });

      // Progress bar drag
      let isDragging = false;

      progressBarHandle.addEventListener("mousedown", () => {
        isDragging = true;
      });

      document.addEventListener("mousemove", (e) => {
        if (isDragging) {
          const rect = progressBar.getBoundingClientRect();
          let percent = (e.clientX - rect.left) / rect.width;
          percent = Math.max(0, Math.min(1, percent));
          playerAudio.currentTime = percent * playerAudio.duration;
        }
      });

      document.addEventListener("mouseup", () => {
        isDragging = false;
      });

      // Volume control
      volumeControl.addEventListener("input", (e) => {
        playerAudio.volume = e.target.value / 100;
      });

      playerAudio.volume = 0.8;

      // Shuffle toggle
      shuffleBtn.addEventListener("click", () => {
        isShuffle = !isShuffle;
        shuffleBtn.classList.toggle("active");
        showToast(isShuffle ? "Shuffle enabled" : "Shuffle disabled");
      });

      // Repeat toggle
      repeatBtn.addEventListener("click", () => {
        repeatMode = (repeatMode + 1) % 3;
        if (repeatMode === 0) {
          repeatBtn.classList.remove("active");
          showToast("Repeat off");
        } else if (repeatMode === 1) {
          repeatBtn.classList.add("active");
          showToast("Repeat all");
        } else {
          repeatBtn.classList.add("active");
          showToast("Repeat one");
        }
      });

      // Like button
      likeBtn.addEventListener("click", () => {
        likeBtn.classList.toggle("active");
        if (likeBtn.classList.contains("active")) {
          showToast("Added to liked songs ‚ù§Ô∏è");
        } else {
          showToast("Removed from liked songs");
        }
      });

      // Show Toast
      function showToast(message) {
        const toast = document.getElementById("toast");
        toast.textContent = message;
        toast.classList.add("show");
        setTimeout(() => toast.classList.remove("show"), 3000);
      }

      // Enhanced playSong function
      function playSong(song) {
        playerImg.src = song.thumbnail || song.coverUrl || song.image || "/Thumbnails/default.png";
        document.getElementById("player-title").textContent = song.title;
        document.getElementById("player-artist").textContent = song.artist || "Unknown Artist";
        playerAudio.src = song.url;
        document.getElementById("player-bar").style.display = "block";
        playerAudio.play().catch((err) => console.error("Play error:", err));
      }

      // Load Saved Songs
      async function loadSavedSongs() {
        const container = document.getElementById("savedSongsList");
        try {
          const res = await fetch(`https://final-project-backend-2-b3de.onrender.com/api/saved-songs/${username}`, ) 
          const data = await res.json();
          
          if (!data.success || !data.songs || data.songs.length === 0) {
            container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì≠</div><p>No saved songs yet</p></div>';
            return;
          }

          container.innerHTML = "";
          data.songs.forEach((song) => {
            const div = document.createElement("div");
            div.className = "song-card";
            div.innerHTML = `
              <img src="${song.thumbnail || song.coverUrl || "/Thumbnails/default.png"}" alt="${song.title}">
              <div class="song-info">
                <div class="title">${song.title}</div>
                <div class="artist">${song.artist || "Unknown Artist"}</div>
              </div>
              <button class="delete-btn">üóëÔ∏è</button>
            `;
            
            div.addEventListener("click", (e) => {
              if (e.target.tagName !== "BUTTON") playSong(song);
            });

            div.querySelector(".delete-btn").addEventListener("click", async (e) => {
              e.stopPropagation();
              if (!confirm(`Delete "${song.title}"?`)) return;
              try {
                const delRes = awaitfetch(`https://final-project-backend-2-b3de.onrender.com/api/delete-song/${username}/${encodeURIComponent(song.title)}`,  {
                  method: "DELETE",
                });
                const delData = await delRes.json();
                if (delData.success) {
                  showToast("Song deleted successfully");
                  loadSavedSongs();
                } else {
                  showToast("Failed to delete song");
                }
              } catch (err) {
                console.error(err);
                showToast("Error deleting song");
              }
            });

            container.appendChild(div);
          });
        } catch (err) {
          console.error(err);
          container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">‚ùå</div><p>Error loading songs</p></div>';
        }
      }

      // Load Trending Songs
      async function loadTrendingSongs() {
        const container = document.getElementById("trending");
        try {
          const res = await fetch("https://final-project-backend-2-b3de.onrender.com/api/trending", );
          const data = await res.json();
          
          if (!Array.isArray(data) || data.length === 0) {
            container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üì≠</div><p>No trending songs</p></div>';
            return;
          }

          container.innerHTML = "";
          data.slice(0, 10).forEach((song) => {
            const div = document.createElement("div");
            div.className = "song-card";
            div.innerHTML = `
              <img src="${song.image || "/Thumbnails/default.png"}" alt="${song.title}">
              <div class="song-info">
                <div class="title">${song.title}</div>
                <div class="artist">${song.artist || "Unknown Artist"}</div>
              </div>
            `;
            div.addEventListener("click", () => playSong(song));
            container.appendChild(div);
          });
        } catch (err) {
          console.error(err);
          container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">‚ùå</div><p>Failed to load trending songs</p></div>';
        }
      }

      // Load Community Uploads
      async function loadCommunityUploads() {
        const container = document.getElementById("community-uploads");
        try {
          const res = await fetch("https://final-project-backend-2-b3de.onrender.com/get-all-uploads", );
          const uploads = await res.json();

          if (uploads.length === 0) {
            container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">üé∂</div><p>No community uploads yet. Be the first!</p></div>';
            return;
          }

          container.innerHTML = "";
          uploads.forEach((upload) => {
            const card = document.createElement("div");
            card.className = "community-song-card";
            card.innerHTML = `
              <img src="${upload.coverUrl}" class="song-cover" alt="${upload.title}" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%22100%22 height=%22100%22%3E%3Crect fill=%22%23ddd%22 width=%22100%22 height=%22100%22/%3E%3C/svg%3E'">
              <div class="community-song-info">
                <h4>${upload.title}</h4>
                <p class="artist">${upload.artist}</p>
                <p class="uploader">By ${upload.uploadedBy}</p>
                <p class="date">${new Date(upload.uploadedAt).toLocaleDateString()}</p>
              </div>
              <div class="action-buttons">
                <button class="play-btn">‚ñ∂Ô∏è Play</button>
                <button class="save-btn">üíæ Save</button>
              </div>
            `;

            card.querySelector(".play-btn").addEventListener("click", () => playSong(upload));
            card.querySelector(".save-btn").addEventListener("click", async () => {
              try {
                const res = await fetch("https://final-project-backend-2-b3de.onrender.com/api/save-song",  {
                  method: "POST",
                  headers: { "Content-Type": "application/json" },
                  body: JSON.stringify({
                    username: username,
                    song: {
                      title: upload.title,
                      artist: upload.artist,
                      album: upload.album,
                      url: upload.url,
                      coverUrl: upload.coverUrl,
                    },
                  }),
                });
                const data = await res.json();
                showToast(data.message);
                if (data.success) loadSavedSongs();
              } catch (err) {
                console.error(err);
                showToast("Failed to save song");
              }
            });

            container.appendChild(card);
          });
        } catch (err) {
          console.error("Error loading community uploads:", err);
          container.innerHTML = '<div class="empty-state"><div class="empty-state-icon">‚ùå</div><p>Failed to load uploads</p></div>';
        }
      }

      // Initialize
      loadSavedSongs();
      loadTrendingSongs();
      loadCommunityUploads();
    });
  </script>
</body>

</html>
